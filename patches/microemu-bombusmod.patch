Index: microemulator/microemu-android/src/org/microemu/android/device/AndroidAudioPlayer.java
===================================================================
--- microemulator/microemu-android/src/org/microemu/android/device/AndroidAudioPlayer.java	(revision 0)
+++ microemulator/microemu-android/src/org/microemu/android/device/AndroidAudioPlayer.java	(revision 0)
@@ -0,0 +1,156 @@
+/*
+ * To change this template, choose Tools | Templates
+ * and open the template in the editor.
+ */
+
+package org.microemu.android.device;
+
+import android.media.MediaPlayer;
+import java.io.File;
+import java.io.FileOutputStream;
+import java.io.IOException;
+import java.io.InputStream;
+import java.util.Vector;
+import java.util.logging.Level;
+import java.util.logging.Logger;
+import javax.microedition.media.Control;
+import javax.microedition.media.MediaException;
+import javax.microedition.media.Player;
+import javax.microedition.media.PlayerListener;
+
+/**
+ *
+ * @author Vitaly
+ */
+public class AndroidAudioPlayer implements Player, PlayerListener {
+
+    protected MediaPlayer player;
+
+    Vector<PlayerListener> listeners = new Vector<PlayerListener>();
+
+    public AndroidAudioPlayer() {
+        player = new MediaPlayer();
+    }
+
+    public void setDataSource(InputStream stream) {
+        try {
+            player.setDataSource(getDataSource(stream));
+        } catch (IOException ex) {
+            Logger.getLogger(AndroidAudioPlayer.class.getName()).log(Level.SEVERE, null, ex);
+        } catch (IllegalArgumentException ex) {
+            Logger.getLogger(AndroidAudioPlayer.class.getName()).log(Level.SEVERE, null, ex);
+        } catch (IllegalStateException ex) {
+            Logger.getLogger(AndroidAudioPlayer.class.getName()).log(Level.SEVERE, null, ex);
+        }
+    }
+    private String getDataSource(InputStream stream) throws IOException {
+        File temp = File.createTempFile("mediaplayertmp", "dat");
+        temp.deleteOnExit();
+        String tempPath = temp.getAbsolutePath();
+        FileOutputStream out = new FileOutputStream(temp);
+        byte buf[] = new byte[2048];
+        do {
+            int numread = stream.read(buf);
+            if (numread <= 0) {
+                break;
+            }
+            out.write(buf, 0, numread);
+        } while (true);
+        stream.close();
+        return tempPath;
+    }
+
+
+    @Override
+    public void realize() throws MediaException {
+        try {
+            player.prepare();
+        } catch (IOException ex) {
+            Logger.getLogger(AndroidAudioPlayer.class.getName()).log(Level.SEVERE, null, ex);
+        } catch (IllegalStateException ex) {
+            Logger.getLogger(AndroidAudioPlayer.class.getName()).log(Level.SEVERE, null, ex);
+        }
+    }
+
+    @Override
+    public void prefetch() throws MediaException {
+        
+    }
+
+    @Override
+    public void start() throws MediaException {
+        
+        player.start();
+    }
+
+    @Override
+    public void stop() throws MediaException {
+        player.stop();
+    }
+
+    @Override
+    public void deallocate() {
+        throw new UnsupportedOperationException("Not supported yet.");
+    }
+
+    @Override
+    public void close() {
+        player.release();
+    }
+
+    @Override
+    public long setMediaTime(long now) throws MediaException {
+        throw new UnsupportedOperationException("Not supported yet.");
+    }
+
+    @Override
+    public long getMediaTime() {
+        throw new UnsupportedOperationException("Not supported yet.");
+    }
+
+    @Override
+    public int getState() {
+        throw new UnsupportedOperationException("Not supported yet.");
+    }
+
+    @Override
+    public long getDuration() {
+        throw new UnsupportedOperationException("Not supported yet.");
+    }
+
+    @Override
+    public String getContentType() {
+        throw new UnsupportedOperationException("Not supported yet.");
+    }
+
+    @Override
+    public void setLoopCount(int count) {
+        throw new UnsupportedOperationException("Not supported yet.");
+    }
+
+    @Override
+    public void addPlayerListener(PlayerListener playerListener) {
+        listeners.add(playerListener);
+    }
+
+    @Override
+    public void removePlayerListener(PlayerListener playerListener) {
+        listeners.remove(playerListener);
+    }
+
+    @Override
+    public Control[] getControls() {
+        throw new UnsupportedOperationException("Not supported yet.");
+    }
+
+    @Override
+    public Control getControl(String controlType) {
+        return new Control() {};
+    }
+
+    @Override
+    public void playerUpdate(Player player, String event, Object eventData) {
+        throw new UnsupportedOperationException("Not supported yet.");
+    }
+
+}
Index: microemulator/microemu-android/src/org/microemu/android/device/AndroidInputMethod.java
===================================================================
--- microemulator/microemu-android/src/org/microemu/android/device/AndroidInputMethod.java	(revision 2504)
+++ microemulator/microemu-android/src/org/microemu/android/device/AndroidInputMethod.java	(working copy)
@@ -284,6 +284,12 @@
 		
 		int resultKeyCode;
 		switch (deviceKeyCode) {
+		case KeyEvent.KEYCODE_CALL :
+			resultKeyCode = -10;
+			break;
+		case KeyEvent.KEYCODE_BACK :
+			resultKeyCode = -8;
+			break;
 		case KeyEvent.KEYCODE_DPAD_CENTER :
 			resultKeyCode = -5;
 			break;
Index: microemulator/microemu-android/src/org/microemu/android/MicroEmulatorActivity.java
===================================================================
--- microemulator/microemu-android/src/org/microemu/android/MicroEmulatorActivity.java	(revision 2504)
+++ microemulator/microemu-android/src/org/microemu/android/MicroEmulatorActivity.java	(working copy)
@@ -168,7 +168,7 @@
                         }
                     }
                 } catch (IOException e) {
-                    Logger.debug(e);
+                    //Logger.debug(e); // large output with BombusMod
                     return null;
                 }
             }
Index: microemulator/microemu-android/src/org/microemu/android/MicroEmulator.java
===================================================================
--- microemulator/microemu-android/src/org/microemu/android/MicroEmulator.java	(revision 2504)
+++ microemulator/microemu-android/src/org/microemu/android/MicroEmulator.java	(working copy)
@@ -119,7 +119,7 @@
         	
         }));
         
-        java.util.List params = new ArrayList();
+        java.util.List<String> params = new ArrayList<String>();
         params.add("--usesystemclassloader");
         params.add("--quit");
         
@@ -147,11 +147,13 @@
         common.initParams(params, null, AndroidDevice.class);
                
         System.setProperty("microedition.platform", "microemulator-android");
+        System.setProperty("device.model", android.os.Build.MODEL);
+        System.setProperty("device.software.version", android.os.Build.VERSION.RELEASE);
         System.setProperty("microedition.locale", Locale.getDefault().toString());
 
 
         /* JSR-75 */
-        Map properties = new HashMap();
+        Map<String, String> properties = new HashMap<String, String>();
         properties.put("fsRoot", "/");
         properties.put("fsSingle", "sdcard");
         common.registerImplementation("org.microemu.cldc.file.FileSystem", properties, false);
@@ -198,6 +200,7 @@
         
         new Thread(new Runnable() {
 
+            @Override
             public void run()
             {
                 MIDletAccess ma = MIDletBridge.getMIDletAccess(midlet);
@@ -214,6 +217,7 @@
                         ((AndroidRepaintListener) contentView).onResume();
                     }
                     post(new Runnable() {
+                        @Override
                         public void run() {
                             contentView.invalidate();
                         }
@@ -336,7 +340,7 @@
 	
     private boolean ignoreKey(int keyCode) {
         switch (keyCode) {
-        case KeyEvent.KEYCODE_MENU:
+//        case KeyEvent.KEYCODE_MENU:
         case KeyEvent.KEYCODE_VOLUME_DOWN:
         case KeyEvent.KEYCODE_VOLUME_UP:
         case KeyEvent.KEYCODE_HEADSETHOOK: 
@@ -362,7 +366,7 @@
     	
     private final static KeyEvent KEY_UP_UP_EVENT = new KeyEvent(KeyEvent.ACTION_UP, KeyEvent.KEYCODE_DPAD_UP);
 
-    private final static float TRACKBALL_THRESHOLD = 0.4f; 
+    private final static float TRACKBALL_THRESHOLD = 1f; 
 	
 	private float accumulatedTrackballX = 0;
 	
@@ -474,4 +478,4 @@
 		return false;
 	}
 
-}
\ No newline at end of file
+}
Index: microemulator/microemu-android/pom.xml
===================================================================
--- microemulator/microemu-android/pom.xml	(revision 2504)
+++ microemulator/microemu-android/pom.xml	(working copy)
@@ -1,27 +1,27 @@
 <?xml version="1.0" encoding="ISO-8859-1"?>
 <project
-	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"
+        xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xmlns="http://maven.apache.org/POM/4.0.0">
     <!-- @version $Revision$ ($Author$) $Date$ -->
-	<modelVersion>4.0.0</modelVersion>
+        <modelVersion>4.0.0</modelVersion>
 
-	<parent>
-		<groupId>org.microemu</groupId>
-		<artifactId>microemu</artifactId>
-		<version>3.0.0-SNAPSHOT</version><!--me-version-->
-		<relativePath>../pom.xml</relativePath>
-	</parent>
+        <parent>
+                <groupId>org.microemu</groupId>
+                <artifactId>microemu</artifactId>
+                <version>3.0.0-SNAPSHOT</version><!--me-version-->
+                <relativePath>../pom.xml</relativePath>
+        </parent>
 
-	<artifactId>microemu-android</artifactId>
-	<name>microemu-android</name>
-    <packaging>android:apk</packaging>
+        <artifactId>microemu-android</artifactId>
+        <name>microemu-android</name>
+<!--        <packaging>android:apk</packaging> -->
 
-	<description>microemu-android</description>
+        <description>microemu-android</description>
 
-	<!--
-	<pluginRepositories>
-		<pluginRepository>
+        <!--
+        <pluginRepositories>
+                <pluginRepository>
             <id>masa-m2-repo.release</id>
             <name>masa maven Release Repository</name>
             <url>http://m2-repo.googlecode.com/svn/release</url>
@@ -32,8 +32,8 @@
                 <enabled>true</enabled>
             </releases>
         </pluginRepository>
-	</pluginRepositories>
-	-->
+        </pluginRepositories>
+        -->
 
     <dependencies>
 
@@ -41,6 +41,12 @@
             <groupId>org.microemu</groupId>
             <artifactId>microemu-midp</artifactId>
             <version>${project.version}</version>
+            <exclusions>
+                <exclusion>
+                    <artifactId>asm</artifactId>
+                    <groupId>asm</groupId>
+                </exclusion>
+            </exclusions>
         </dependency>
 
         <dependency>
@@ -55,10 +61,18 @@
             <version>${project.version}</version>
         </dependency>
 
+        <dependency>
+            <groupId>org.microemu</groupId>
+            <artifactId>microemu-jsr-135</artifactId>
+            <version>${project.version}</version>
+            <type>jar</type>
+        </dependency>
+
         <!--
            mvn install:install-file -DgroupId=android -DartifactId=android -Dversion=1.1_r1 -Dpackaging=jar -Dfile=${ANDROID_SDK}/android.jar
            mvn install:install-file -DgroupId=android -DartifactId=android -Dversion=1.1_r1 -Dpackaging=jar -Dfile=%ANDROID_SDK%\android.jar
          -->
+<!--
         <dependency>
             <groupId>com.android</groupId>
             <artifactId>android</artifactId>
@@ -66,30 +80,72 @@
             <scope>system</scope>
             <systemPath>${ANDROID_SDK}/android.jar</systemPath>
         </dependency>
+-->
 
+        <dependency>
+            <groupId>org.objectweb.asm</groupId>
+            <artifactId>asm</artifactId>
+            <version>3.2</version>
+            <scope>system</scope>
+            <systemPath>${PATH_TO_MICROEMU}/microemu/microemulator/microemu-android/asm-3.2.jar</systemPath>
+        </dependency>
+        <dependency>
+            <groupId>org.objectweb.asm.tree</groupId>
+            <artifactId>asm-tree</artifactId>
+            <version>3.2</version>
+            <scope>system</scope>
+            <systemPath>${PATH_TO_MICROEMU}/microemu/microemulator/microemu-android/asm-tree-3.2.jar</systemPath>
+        </dependency>
+        <dependency>
+            <groupId>com.google.android</groupId>
+            <artifactId>android</artifactId>
+            <version>2.2.1</version>
+        </dependency>
     </dependencies>
 
-	<build>
-	    <sourceDirectory>src</sourceDirectory>
-		<plugins>
+<!--
+        <build>
+            <sourceDirectory>src</sourceDirectory>
+                <plugins>
 
-			<plugin>
-				<artifactId>maven-compiler-plugin</artifactId>
-				<configuration>
-					<source>1.5</source>
-					<target>1.5</target>
-				</configuration>
-			</plugin>
+                        <plugin>
+                                <artifactId>maven-compiler-plugin</artifactId>
+                                <configuration>
+                                        <source>1.5</source>
+                                        <target>1.5</target>
+                                </configuration>
+                        </plugin>
 
-		    <plugin>
+                    <plugin>
                 <groupId>org.jvending.masa.plugins</groupId>
                 <artifactId>maven-dx-plugin</artifactId>
                 <extensions>true</extensions>
                 <version>1.2-SNAPSHOT</version>
             </plugin>
 
-		</plugins>
-	</build>
+                </plugins>
+        </build>
+-->
 
+    <build>
+        <sourceDirectory>src</sourceDirectory>
+        <plugins>
+            <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-compiler-plugin</artifactId>
+                <configuration>
+                    <source>1.6</source>
+                    <target>1.6</target>
+                </configuration>
+            </plugin>
+<!--
+            <plugin>
+                 <groupId>org.jvending.masa.plugins</groupId>
+                 <artifactId>maven-dx-plugin</artifactId>
+                 <extensions>true</extensions>
+            </plugin>
+-->
+        </plugins>
+    </build>
 
-</project>
\ No newline at end of file
+</project>
Index: microemulator/microemu-android/build.xml
===================================================================
--- microemulator/microemu-android/build.xml	(revision 2504)
+++ microemulator/microemu-android/build.xml	(working copy)
@@ -4,16 +4,18 @@
 <project name="microemu-android" default="package-apk">
     
     <!-- IMPORTANT TO SET WITH VALID VALUES --> 
+    <property name="midlet.jad" value="${PATH_TO_BOMBUSMOD_JAD}" />
+    <property name="midlet.package" value="BombusMod-unsigned.apk" />
 
-    <property name="midlet.jad" value="../microemu-examples/microemu-demo/target/microemu-demo-3.0.0-SNAPSHOT-me.jad" /> 
-    <property name="midlet.package" value="SimpleDemo.apk" />
-    
-    <property name="sdk-folder" value="\java\android-sdk-windows" />
-	<property name="sdk-platform-folder" value="${sdk-folder}/platforms/android-1.6" />
+
+    <property name="sdk-folder" value="/opt/android-sdk-update-manager" />
+        <property name="sdk-platform-folder" value="${sdk-folder}/platforms/android-4" />
     <property name="microemu-cldc.jar" value="../microemu-cldc/target/microemu-cldc-3.0.0-SNAPSHOT.jar" />
     <property name="microemu-midp.jar" value="../microemu-midp/target/microemu-midp-3.0.0-SNAPSHOT.jar" />
     <property name="microemu-javase.jar" value="../microemu-javase/target/microemu-javase-3.0.0-SNAPSHOT.jar" />
     <property name="microemu-jsr-75.jar" value="../microemu-extensions/microemu-jsr-75/target/microemu-jsr-75-3.0.0-SNAPSHOT.jar" />
+    <property name="microemu-jsr-135.jar" value="../microemu-extensions/microemu-jsr-135/target/microemu-jsr-135-3.0.0-SNAPSHOT.jar" />
+    <property name="asm.jar" value="asm-3.2.jar"/>
 
     <property name="outdir" value="bin" />
 
@@ -33,61 +35,61 @@
 
     <!-- Tools -->
     <property name="sdk-platform-tools" value="${sdk-folder}/platform-tools" />
-	
-	<condition property="aapt" value="${sdk-platform-tools}/aapt" else="${sdk-platform-folder}/tools/aapt">
-		<available file="${sdk-platform-tools}" type="dir" />
-	</condition>
-	
-	<condition property="adb" value="${sdk-platform-tools}/adb" else="${sdk-folder}/tools/adb">
-		<available file="${sdk-platform-tools}" type="dir" />
-	</condition>
+        
+        <condition property="aapt" value="${sdk-platform-tools}/aapt" else="${sdk-platform-folder}/tools/aapt">
+                <available file="${sdk-platform-tools}" type="dir" />
+        </condition>
+        
+        <condition property="adb" value="${sdk-platform-tools}/adb" else="${sdk-folder}/tools/adb">
+                <available file="${sdk-platform-tools}" type="dir" />
+        </condition>
     
-	<condition property="dx" value="${sdk-platform-tools}/dx.bat">
-		<and>
-        	<os family="windows"/>
-			<available file="${sdk-platform-tools}" type="dir" />
-		</and>
+        <condition property="dx" value="${sdk-platform-tools}/dx.bat">
+                <and>
+                <os family="windows"/>
+                        <available file="${sdk-platform-tools}" type="dir" />
+                </and>
     </condition>
     <condition property="dx" value="${sdk-platform-folder}/tools/dx.bat">
-    	<and>
-        	<os family="windows"/>
-    		<not>
-    			<available file="${sdk-platform-tools}" type="dir" />
-    		</not>
-    	</and>
-    </condition>	
+            <and>
+                <os family="windows"/>
+                    <not>
+                            <available file="${sdk-platform-tools}" type="dir" />
+                    </not>
+            </and>
+    </condition>        
     <condition property="dx" value="${sdk-platform-tools}/dx">
-    	<and>
-	    	<not>
-	        	<os family="windows"/>
-	    	</not>
-    		<available file="${sdk-platform-tools}" type="dir" />
-    	</and>
-    </condition>	
+            <and>
+                    <not>
+                        <os family="windows"/>
+                    </not>
+                    <available file="${sdk-platform-tools}" type="dir" />
+            </and>
+    </condition>        
     <condition property="dx" value="${sdk-platform-folder}/tools/dx">
-    	<and>
-	    	<not>
-	        	<os family="windows"/>
-	    	</not>
-    		<not>
-    			<available file="${sdk-platform-tools}" type="dir" />
-    		</not>
-    	</and>
-    </condition>	
-	
-	<condition property="apk-builder" value="${sdk-folder}/tools/apkbuilder.bat" else="${sdk-folder}/tools/apkbuilder" >
+            <and>
+                    <not>
+                        <os family="windows"/>
+                    </not>
+                    <not>
+                            <available file="${sdk-platform-tools}" type="dir" />
+                    </not>
+            </and>
+    </condition>        
+        
+        <condition property="apk-builder" value="${sdk-folder}/tools/apkbuilder.bat" else="${sdk-folder}/tools/apkbuilder" >
         <os family="windows"/>
     </condition>
-	
+        
     <property name="android-jar" value="${sdk-platform-folder}/android.jar" />
-	
-	<taskdef resource="net/sf/antcontrib/antcontrib.properties">
-	    <classpath>
-	        <pathelement location="ant-contrib-1.0b3.jar"/>
-	    </classpath>
-	</taskdef>
-	
-	<macrodef name="loadjad">
+        
+        <taskdef resource="net/sf/antcontrib/antcontrib.properties">
+            <classpath>
+                <pathelement location="ant-contrib-1.0b3.jar"/>
+            </classpath>
+        </taskdef>
+        
+        <macrodef name="loadjad">
         <attribute name="jad"/>
         <attribute name="prefix" default=""/>
         <sequential>
@@ -96,7 +98,7 @@
                     <prefixlines prefix="@{prefix}"/>
                 </filterchain>
             </loadproperties>
-        </sequential>		
+        </sequential>                
     </macrodef>
     
     <target name="clean">
@@ -115,6 +117,8 @@
 
         <available file="${microemu-jsr-75.jar}" property="microemu-jsr-75.jar.present"/>
         <fail unless="microemu-jsr-75.jar.present" message="microemu-jsr-75.jar doesn't exist at ${microemu-jsr-75.jar}"/>
+        <available file="${microemu-jsr-135.jar}" property="microemu-jsr-135.jar.present"/>
+        <fail unless="microemu-jsr-135.jar.present" message="microemu-jsr-135.jar doesn't exist at ${microemu-jsr-135.jar}"/>
     </target>
 
     <target name="dirs">
@@ -130,80 +134,82 @@
         <javac target="1.5" debug="true" extdirs=""
                 srcdir="src"
                 destdir="${outdir-producer}"
-                includes="org/microemu/android/asm/**">
+                includes="org/microemu/android/asm/**" includeantruntime="true">
             <classpath>
                 <pathelement location="${microemu-javase.jar}"/>
+                <pathelement location="${microemu-jsr-135.jar}"/>
                 <pathelement location="asm-3.2.jar"/>
                 <pathelement location="asm-tree-3.2.jar"/>
             </classpath>
+            <compilerarg value="-Xlint:unchecked" />
         </javac>
     </target>
-	
+        
     <target name="read-jad">
         <loadjad jad="${midlet.jad}" prefix="jad."/>
-    	
+            
         <basename file="${midlet.jad}" property="midlet.jad.basename"/>
-    	
+            
         <propertyregex property="jar.first.character" 
                 input="${jad.MIDlet-Jar-URL}"
                 regexp="^\/"
                 select="\0" />
-    	<if>
-    	    <equals arg1="${jar.first.character}" arg2="/" />
-    		<then>
-    			<property name="midlet.jar" value="${jad.MIDlet-Jar-URL}" />
-    		</then>
-    		<else>
-    			<dirname property="midlet.jad.dir" file="${midlet.jad}"/>
-    			<property name="midlet.jar" value="${midlet.jad.dir}/${jad.MIDlet-Jar-URL}" />
-    		</else>
-    	</if>    		
+            <if>
+                <equals arg1="${jar.first.character}" arg2="/" />
+                    <then>
+                            <property name="midlet.jar" value="${jad.MIDlet-Jar-URL}" />
+                    </then>
+                    <else>
+                            <dirname property="midlet.jad.dir" file="${midlet.jad}"/>
+                            <property name="midlet.jar" value="${midlet.jad.dir}/${jad.MIDlet-Jar-URL}" />
+                    </else>
+            </if>                    
 
         <propertyregex property="midlet.name" 
                 input="${jad.MIDlet-1}"
                 regexp="([^,]+),([^,]+),([^,]+)"
                 select="\1" />
 
-    	<echo>midlet.name = [${midlet.name}]</echo>
+            <echo>midlet.name = [${midlet.name}]</echo>
 
-    	<fail unless="midlet.name" message="No midlet name defined in jad."/><!--if MIDlet-1: ,[ICON],[CLASS] notice the NO [TITLE] -->
+            <fail unless="midlet.name" message="No midlet name defined in jad."/><!--if MIDlet-1: ,[ICON],[CLASS] notice the NO [TITLE] -->
 
         <propertyregex property="midlet.icon.totrim" 
                 input="${jad.MIDlet-1}"
                 regexp="([^,]+),([^,]+),([^,]+)"
                 select="\2" />
 
-    	<echo>midlet.icon.totrim = [${midlet.icon.totrim}]</echo>
+            <echo>midlet.icon.totrim = [${midlet.icon.totrim}]</echo>
 
-    	<fail unless="midlet.icon.totrim" message="No icon defined in jad."/><!--if MIDlet-1: [TITLE],,[CLASS] notice the NO space in the [ICON] placeholder -->
+            <fail unless="midlet.icon.totrim" message="No icon defined in jad."/><!--if MIDlet-1: [TITLE],,[CLASS] notice the NO space in the [ICON] placeholder -->
 
         <propertyregex property="midlet.icon" 
                 input="${midlet.icon.totrim}"
                 regexp="^[ \t]+|[ \t]+$"
                 replace=""
-    	        defaultValue="${midlet.icon.totrim}" /><!-- if nothing to trim-->
+                    defaultValue="${midlet.icon.totrim}" /><!-- if nothing to trim-->
 
-    	<echo>midlet.icon = [${midlet.icon}]</echo>
+            <echo>midlet.icon = [${midlet.icon}]</echo>
 
-    	<condition property="NotHasIcon">
-    	  <equals arg1="${midlet.icon}" arg2=""/>
-    	</condition>
-    	<fail if="NotHasIcon" message="No valid icon set in jad."/> <!--if MIDlet-1: [TITLE], ,[CLASS] notice the space in the [ICON] placeholder -->
+            <condition property="NotHasIcon">
+              <equals arg1="${midlet.icon}" arg2=""/>
+            </condition>
+            <fail if="NotHasIcon" message="No valid icon set in jad."/> <!--if MIDlet-1: [TITLE], ,[CLASS] notice the space in the [ICON] placeholder -->
 
         <propertyregex property="midlet.class.totrim" 
                 input="${jad.MIDlet-1}"
                 regexp="([^,]+),([^,]+),([^,]+)"
                 select="\3" />
 
-    	<echo>midlet.class.totrim = [${midlet.class.totrim}]</echo>
+            <echo>midlet.class.totrim = [${midlet.class.totrim}]</echo>
 
         <propertyregex property="midlet.class" 
                 input="${midlet.class.totrim}"
                 regexp="^[ \t]+|[ \t]+$"
                 replace=""
-    	        defaultValue="${midlet.class.totrim}" />    	
-	</target>
-	
+                    defaultValue="${midlet.class.totrim}" />            
+        </target>
+        
     <target name="prepare-jars" depends="compile-producer,read-jad">
         <java classname="org.microemu.android.asm.AndroidProducer">            
             <arg value="${midlet.jar}"/>
@@ -212,6 +218,7 @@
             <classpath>
                 <pathelement path="${outdir-producer}"/>
                 <pathelement location="${microemu-javase.jar}"/>
+                <pathelement location="${microemu-jsr-135.jar}"/>
                 <pathelement location="asm-3.2.jar"/>
                 <pathelement location="asm-tree-3.2.jar"/>
             </classpath>
@@ -223,26 +230,31 @@
                 srcdir="src"
                 destdir="${outdir-classes}"
                 bootclasspath="${android-jar}"
-                excludes="org/microemu/android/asm/**">
+                excludes="org/microemu/android/asm/**"
+                includeantruntime="true">
             <classpath>
                 <pathelement location="${microemu-cldc.jar}" />
                 <pathelement location="${microemu-midp.jar}" />
                 <pathelement location="${microemu-javase.jar}"/>
+                <pathelement location="${microemu-jsr-135.jar}"/>
             </classpath>
+            <compilerarg value="-Xlint:unchecked" />
         </javac>
     </target>
 
     <target name="dex" depends="compile">
         <basename property="intermediate-dex.base" file="${intermediate-dex}"/>
         <dirname property="intermediate-dex.dir" file="${intermediate-dex}"/>
-    	<basename property="microemu-cldc.jar.base" file="${microemu-cldc.jar}"/>
-    	<dirname property="microemu-cldc.jar.dir" file="${microemu-cldc.jar}"/>
+            <basename property="microemu-cldc.jar.base" file="${microemu-cldc.jar}"/>
+            <dirname property="microemu-cldc.jar.dir" file="${microemu-cldc.jar}"/>
         <basename property="microemu-midp.jar.base" file="${microemu-midp.jar}"/>
         <dirname property="microemu-midp.jar.dir" file="${microemu-midp.jar}"/>
         <basename property="microemu-javase.jar.base" file="${microemu-javase.jar}"/>
         <dirname property="microemu-javase.jar.dir" file="${microemu-javase.jar}"/>
         <basename property="microemu-jsr-75.jar.base" file="${microemu-jsr-75.jar}"/>
         <dirname property="microemu-jsr-75.jar.dir" file="${microemu-jsr-75.jar}"/>
+        <basename property="microemu-jsr-135.jar.base" file="${microemu-jsr-135.jar}"/>
+        <dirname property="microemu-jsr-135.jar.dir" file="${microemu-jsr-135.jar}"/>
         <basename property="prepared.midlet.jar.base" file="${outdir-libs}/midlet.jar"/>
         <dirname property="prepared.midlet.jar.dir" file="${outdir-libs}/midlet.jar"/>
         <exec executable="${dx}" failonerror="true">
@@ -253,6 +265,7 @@
             <arg value="${microemu-midp.jar.dir}/${microemu-midp.jar.base}" />
             <arg value="${microemu-javase.jar.dir}/${microemu-javase.jar.base}"/>
             <arg value="${microemu-jsr-75.jar.dir}/${microemu-jsr-75.jar.base}"/>
+            <arg value="${microemu-jsr-135.jar.dir}/${microemu-jsr-135.jar.base}"/>
             <arg path="${outdir-classes}" />
             <arg value="${prepared.midlet.jar.dir}/${prepared.midlet.jar.base}"/>
         </exec>
@@ -281,11 +294,11 @@
         </echo>
         
         <mkdir dir="${outdir-res}/drawable" />
-    	<unjar src="${midlet.jar}" dest="${outdir}">
-    	    <patternset>
-    	        <include name="${midlet.icon}"/>
-    	    </patternset>
-    	</unjar>
+            <unjar src="${midlet.jar}" dest="${outdir}">
+                <patternset>
+                    <include name="${midlet.icon}"/>
+                </patternset>
+            </unjar>
         <copy file="${outdir}/assets/${midlet.icon}" tofile="${outdir-res}/drawable/app_icon.png" />
         
         <echo file="${outdir}/AndroidManifest.xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
@@ -293,6 +306,7 @@
         package="org.microemu.android.${midlet.class}"&gt;
     &lt;uses-permission android:name="android.permission.INTERNET" /&gt; 
     &lt;uses-permission android:name="android.permission.VIBRATE" /&gt; 
+    &lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt;
     &lt;supports-screens android:smallScreens="true" android:normalScreens="true" android:largeScreens="true" android:anyDensity="true" /&gt;
     &lt;uses-sdk android:minSdkVersion="4" android:targetSdkVersion="4" /&gt;
     &lt;application android:label="@string/app_name" android:icon="@drawable/app_icon"&gt;
@@ -336,7 +350,7 @@
         <dirname property="intermediate-dex.dir" file="${intermediate-dex}"/>
         <exec executable="${apk-builder}" failonerror="true">
             <arg value="${out-package.dir}/${out-package.base}" />
-<!--            <arg value="-u" /> -->
+            <arg value="-u" /> <!-- unsigned -->
             <arg value="-z" />
             <arg value="${out-package.dir}/${out-package.base}.res" /> <!-- temp name -->
             <arg value="-f" />
@@ -372,4 +386,4 @@
     </target>
 
         
-</project>
\ No newline at end of file
+</project>
Index: microemulator/microemu-extensions/microemu-jsr-135/src/main/java/javax/microedition/media/Manager.java
===================================================================
--- microemulator/microemu-extensions/microemu-jsr-135/src/main/java/javax/microedition/media/Manager.java	(revision 2504)
+++ microemulator/microemu-extensions/microemu-jsr-135/src/main/java/javax/microedition/media/Manager.java	(working copy)
@@ -31,6 +31,7 @@
 import java.io.InputStream;
 import java.util.Iterator;
 import java.util.Vector;
+import org.microemu.android.device.AndroidAudioPlayer;
 
 public final class Manager
 {
@@ -71,16 +72,24 @@
     	if( type.equals( "audio/x-wav" ) || type.equals( "audio/basic" ) || 
     		type.equals( "audio/mpeg" )  )
     	{
+/*
     	  	SampledAudioPlayer audPlayer = new SampledAudioPlayer();
         	audPlayer.open( stream, type );
+*/
+                AndroidAudioPlayer audPlayer = new AndroidAudioPlayer();
+                audPlayer.setDataSource( stream );
         	
         	vMedia.add( audPlayer );
             return audPlayer;
         }
     	else if( type.equals( "audio/midi" ) )
     	{
+/*
     	  	MidiAudioPlayer midiPlayer = new MidiAudioPlayer();
         	midiPlayer.open( stream, type );
+*/
+                AndroidAudioPlayer midiPlayer = new AndroidAudioPlayer();
+                midiPlayer.setDataSource( stream );
         	
         	vMedia.add( midiPlayer );
             return midiPlayer;
Index: microemulator/microemu-extensions/microemu-jsr-135/pom.xml
===================================================================
--- microemulator/microemu-extensions/microemu-jsr-135/pom.xml	(revision 2504)
+++ microemulator/microemu-extensions/microemu-jsr-135/pom.xml	(working copy)
@@ -31,7 +31,13 @@
                 <artifactId>microemu-javase-swing</artifactId>
                 <version>${project.version}</version>
             </dependency>
-            
+            <dependency>
+                <groupId>org.microemu</groupId>
+                <artifactId>microemu-android</artifactId>
+                <version>3.0.0-SNAPSHOT</version>
+                  <type>jar</type>
+	    </dependency>
+
 <!--
             <dependency>
                 <groupId>junit</groupId>
@@ -49,4 +55,4 @@
 -->
     </dependencies>
 
-</project>
\ No newline at end of file
+</project>
